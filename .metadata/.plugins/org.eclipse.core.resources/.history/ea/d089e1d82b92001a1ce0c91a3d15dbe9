package com.cg.gops.service;

import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.cg.gops.dao.ProductRepository;
import com.cg.gops.entity.ProductEntity;
import com.cg.gops.exception.ProductNotFoundException;
import com.cg.gops.model.ProductModel;

@Service
public class ProductServiceImpl implements ProductService{

	@Autowired
	private ProductRepository productRepository;
	
    private ProductEntity of(ProductModel source) {
    	ProductEntity result=null;
    	if(source!=null) {
    		result=new ProductEntity();
    		result.setProductId(source.getProductId());
    		result.setProductName(source.getProductName());
    		result.setProductPrice(source.getProductPrice());
    		result.setProductCategory(source.getProductCategory());
    		result.setProductQuantity(source.getProductQuantity());
    		result.setProductSpecification(source.getProductSpecification());
    	}
    	return result;
   
    }
    private ProductModel of(ProductEntity source) {
    	ProductModel result=null;
    	if(source!=null) {
    		result=new ProductModel();
    		result.setProductId(source.getProductId());
    		result.setProductName(source.getProductName());
    		result.setProductPrice(source.getProductPrice());
    		result.setProductCategory(source.getProductCategory());
    		result.setProductQuantity(source.getProductQuantity());
    		result.setProductSpecification(source.getProductSpecification());
    	}
    	return result;
    }
	@Override
	public List<ProductModel> getAllProducts() {
		
		return productRepository.findAll().stream().map((entity)->of(entity)).collect(Collectors.toList());
	}

	@Override
	public ProductModel getProductById(String id) {
		
		Optional<ProductEntity> entity=productRepository.findById(id);
		return entity.isPresent()? of(entity.get()):null;
	}

	@Override
	public ProductModel addProduct(ProductModel productModel) {

		return of(productRepository.save(of(productModel)));
	}

	@Override
	public ProductModel updateProduct(ProductModel productModel) throws ProductNotFoundException {
		if(!(productRepository.existsById(productModel.getProductId()))) {
			throw new ProductNotFoundException("Product Id does not exist !");
		}
		else {
			return of(productRepository.save(of(productModel)));
		}
	
	}

	@Override
	public void deleteProduct(ProductModel product) throws ProductNotFoundException{
		if(!(productRepository.findById(product.getProductId()).isPresent())) {
			throw new ProductNotFoundException("Product Id does not exist !");
		}
		else {
			productRepository.deleteById(product.getProductId());
		}
	}

}
